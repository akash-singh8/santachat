import popStyle from "../assets/styles/popup.module.css";
import style from "../assets/styles/feedback.module.css";
import Window from "./Window";
import { useEffect } from "react";

const Feedback = () => {
  let rating = 0;

  useEffect(() => {
    const stars = document.querySelectorAll(`.${style.rating} svg`);

    stars.forEach((star) => {
      star.addEventListener("click", () => {
        // @ts-ignore
        rating = parseInt(star.dataset.ind);

        for (let i = 0; i < rating; i++) {
          // @ts-ignore
          stars[i].style.fill = "#b30738";
        }

        for (let i = rating; i < 5; i++) {
          // @ts-ignore
          stars[i].style.fill = "#d9d9d9";
        }
      });
    });
  }, []);

  const handleSubmit = async () => {
    const feedback = document.querySelector(
      `.${style.feedback} input`
    ) as HTMLInputElement;
    try {
      const res = await fetch(`${import.meta.env.VITE_BACKEND_URL}/feedback`, {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          authorization: localStorage.getItem("authToken")!,
        },
        body: JSON.stringify({
          feedback: feedback.value,
          rating: rating,
          time: new Date(),
        }),
      });

      const data = await res.json();

      alert(data.message);
    } catch (e) {
      console.log(e);
      alert("Unable to send feedback at present moment!");
    }

    window.location.href = "/";
  };

  return (
    <div className={popStyle.container}>
      <div style={{ maxWidth: "628px" }}>
        <Window type="feedback">
          <div className={style.feedback}>
            <h2>FEEDBACK</h2>
            <p>
              What are somethings you assumed about the person after talking to
              him/her
            </p>

            <div className={popStyle.input}>
              <input type="text" placeholder="feedback..." />
            </div>

            <ul className={style.rating}>
              <li>
                <svg width="26" height="26" viewBox="0 0 20 20" data-ind="1">
                  <path d="M7.68353 3.26767C8.89788 1.08923 9.50503 0 10.4128 0C11.3206 0 11.9278 1.08922 13.1421 3.26766L13.4563 3.83125C13.8014 4.45029 13.9739 4.75982 14.243 4.96405C14.512 5.16827 14.847 5.24408 15.5171 5.3957L16.1273 5.53373C18.4853 6.06729 19.6644 6.33406 19.945 7.23613C20.2255 8.13815 19.4217 9.07817 17.814 10.958L17.3981 11.4444C16.9413 11.9786 16.7128 12.2457 16.6101 12.5761C16.5074 12.9066 16.5419 13.263 16.6109 13.9758L16.6738 14.6246C16.9169 17.1328 17.0384 18.3869 16.304 18.9444C15.5696 19.5019 14.4656 18.9936 12.2577 17.9771L11.6865 17.714C11.0591 17.4251 10.7454 17.2807 10.4128 17.2807C10.0803 17.2807 9.76657 17.4251 9.13919 17.714L8.56798 17.9771C6.36004 18.9936 5.25608 19.5019 4.52168 18.9444C3.78727 18.3869 3.9088 17.1328 4.15185 14.6246L4.21472 13.9758C4.2838 13.263 4.31833 12.9066 4.21557 12.5761C4.11281 12.2457 3.8844 11.9786 3.42756 11.4444L3.01165 10.958C1.40403 9.07817 0.600215 8.13815 0.880735 7.23613C1.16126 6.33406 2.34032 6.06729 4.69845 5.53373L5.30853 5.3957C5.97864 5.24408 6.31369 5.16827 6.58271 4.96405C6.85174 4.75982 7.02429 4.4503 7.36937 3.83125L7.68353 3.26767Z" />
                </svg>
              </li>
              <li>
                <svg width="26" height="26" viewBox="0 0 20 20" data-ind="2">
                  <path d="M7.68353 3.26767C8.89788 1.08923 9.50503 0 10.4128 0C11.3206 0 11.9278 1.08922 13.1421 3.26766L13.4563 3.83125C13.8014 4.45029 13.9739 4.75982 14.243 4.96405C14.512 5.16827 14.847 5.24408 15.5171 5.3957L16.1273 5.53373C18.4853 6.06729 19.6644 6.33406 19.945 7.23613C20.2255 8.13815 19.4217 9.07817 17.814 10.958L17.3981 11.4444C16.9413 11.9786 16.7128 12.2457 16.6101 12.5761C16.5074 12.9066 16.5419 13.263 16.6109 13.9758L16.6738 14.6246C16.9169 17.1328 17.0384 18.3869 16.304 18.9444C15.5696 19.5019 14.4656 18.9936 12.2577 17.9771L11.6865 17.714C11.0591 17.4251 10.7454 17.2807 10.4128 17.2807C10.0803 17.2807 9.76657 17.4251 9.13919 17.714L8.56798 17.9771C6.36004 18.9936 5.25608 19.5019 4.52168 18.9444C3.78727 18.3869 3.9088 17.1328 4.15185 14.6246L4.21472 13.9758C4.2838 13.263 4.31833 12.9066 4.21557 12.5761C4.11281 12.2457 3.8844 11.9786 3.42756 11.4444L3.01165 10.958C1.40403 9.07817 0.600215 8.13815 0.880735 7.23613C1.16126 6.33406 2.34032 6.06729 4.69845 5.53373L5.30853 5.3957C5.97864 5.24408 6.31369 5.16827 6.58271 4.96405C6.85174 4.75982 7.02429 4.4503 7.36937 3.83125L7.68353 3.26767Z" />
                </svg>
              </li>
              <li>
                <svg width="26" height="26" viewBox="0 0 20 20" data-ind="3">
                  <path d="M7.68353 3.26767C8.89788 1.08923 9.50503 0 10.4128 0C11.3206 0 11.9278 1.08922 13.1421 3.26766L13.4563 3.83125C13.8014 4.45029 13.9739 4.75982 14.243 4.96405C14.512 5.16827 14.847 5.24408 15.5171 5.3957L16.1273 5.53373C18.4853 6.06729 19.6644 6.33406 19.945 7.23613C20.2255 8.13815 19.4217 9.07817 17.814 10.958L17.3981 11.4444C16.9413 11.9786 16.7128 12.2457 16.6101 12.5761C16.5074 12.9066 16.5419 13.263 16.6109 13.9758L16.6738 14.6246C16.9169 17.1328 17.0384 18.3869 16.304 18.9444C15.5696 19.5019 14.4656 18.9936 12.2577 17.9771L11.6865 17.714C11.0591 17.4251 10.7454 17.2807 10.4128 17.2807C10.0803 17.2807 9.76657 17.4251 9.13919 17.714L8.56798 17.9771C6.36004 18.9936 5.25608 19.5019 4.52168 18.9444C3.78727 18.3869 3.9088 17.1328 4.15185 14.6246L4.21472 13.9758C4.2838 13.263 4.31833 12.9066 4.21557 12.5761C4.11281 12.2457 3.8844 11.9786 3.42756 11.4444L3.01165 10.958C1.40403 9.07817 0.600215 8.13815 0.880735 7.23613C1.16126 6.33406 2.34032 6.06729 4.69845 5.53373L5.30853 5.3957C5.97864 5.24408 6.31369 5.16827 6.58271 4.96405C6.85174 4.75982 7.02429 4.4503 7.36937 3.83125L7.68353 3.26767Z" />
                </svg>
              </li>
              <li>
                <svg width="26" height="26" viewBox="0 0 20 20" data-ind="4">
                  <path d="M7.68353 3.26767C8.89788 1.08923 9.50503 0 10.4128 0C11.3206 0 11.9278 1.08922 13.1421 3.26766L13.4563 3.83125C13.8014 4.45029 13.9739 4.75982 14.243 4.96405C14.512 5.16827 14.847 5.24408 15.5171 5.3957L16.1273 5.53373C18.4853 6.06729 19.6644 6.33406 19.945 7.23613C20.2255 8.13815 19.4217 9.07817 17.814 10.958L17.3981 11.4444C16.9413 11.9786 16.7128 12.2457 16.6101 12.5761C16.5074 12.9066 16.5419 13.263 16.6109 13.9758L16.6738 14.6246C16.9169 17.1328 17.0384 18.3869 16.304 18.9444C15.5696 19.5019 14.4656 18.9936 12.2577 17.9771L11.6865 17.714C11.0591 17.4251 10.7454 17.2807 10.4128 17.2807C10.0803 17.2807 9.76657 17.4251 9.13919 17.714L8.56798 17.9771C6.36004 18.9936 5.25608 19.5019 4.52168 18.9444C3.78727 18.3869 3.9088 17.1328 4.15185 14.6246L4.21472 13.9758C4.2838 13.263 4.31833 12.9066 4.21557 12.5761C4.11281 12.2457 3.8844 11.9786 3.42756 11.4444L3.01165 10.958C1.40403 9.07817 0.600215 8.13815 0.880735 7.23613C1.16126 6.33406 2.34032 6.06729 4.69845 5.53373L5.30853 5.3957C5.97864 5.24408 6.31369 5.16827 6.58271 4.96405C6.85174 4.75982 7.02429 4.4503 7.36937 3.83125L7.68353 3.26767Z" />
                </svg>
              </li>
              <li>
                <svg width="26" height="26" viewBox="0 0 20 20" data-ind="5">
                  <path d="M7.68353 3.26767C8.89788 1.08923 9.50503 0 10.4128 0C11.3206 0 11.9278 1.08922 13.1421 3.26766L13.4563 3.83125C13.8014 4.45029 13.9739 4.75982 14.243 4.96405C14.512 5.16827 14.847 5.24408 15.5171 5.3957L16.1273 5.53373C18.4853 6.06729 19.6644 6.33406 19.945 7.23613C20.2255 8.13815 19.4217 9.07817 17.814 10.958L17.3981 11.4444C16.9413 11.9786 16.7128 12.2457 16.6101 12.5761C16.5074 12.9066 16.5419 13.263 16.6109 13.9758L16.6738 14.6246C16.9169 17.1328 17.0384 18.3869 16.304 18.9444C15.5696 19.5019 14.4656 18.9936 12.2577 17.9771L11.6865 17.714C11.0591 17.4251 10.7454 17.2807 10.4128 17.2807C10.0803 17.2807 9.76657 17.4251 9.13919 17.714L8.56798 17.9771C6.36004 18.9936 5.25608 19.5019 4.52168 18.9444C3.78727 18.3869 3.9088 17.1328 4.15185 14.6246L4.21472 13.9758C4.2838 13.263 4.31833 12.9066 4.21557 12.5761C4.11281 12.2457 3.8844 11.9786 3.42756 11.4444L3.01165 10.958C1.40403 9.07817 0.600215 8.13815 0.880735 7.23613C1.16126 6.33406 2.34032 6.06729 4.69845 5.53373L5.30853 5.3957C5.97864 5.24408 6.31369 5.16827 6.58271 4.96405C6.85174 4.75982 7.02429 4.4503 7.36937 3.83125L7.68353 3.26767Z" />
                </svg>
              </li>
            </ul>

            <div className={style.buttons}>
              <button
                style={{ color: "#CDCDCD" }}
                onClick={() => (window.location.href = "/")}
              >
                CANCLE
              </button>
              <button onClick={handleSubmit}>SUBMIT</button>
            </div>
          </div>
        </Window>
      </div>
    </div>
  );
};

export default Feedback;
